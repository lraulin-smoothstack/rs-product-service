{
  "Resource": {
    "Type": "AWS::ApiGateway::Resource",
    "Properties": {
      "RestApiId": { "Ref": "RestApi" },
      "ParentId": { "Fn::GetAtt": ["RestApi", "RootResourceId"] },
      "PathPart": "user"
    }
  },
  "Put": {
    "Type": "AWS::ApiGateway::Method",
    "DependsOn": "LambdaPermission",
    "Properties": {
      "AuthorizationType": "CUSTOM",
      "AuthorizerId": { "Ref": "RestApiAuthorizer" },
      "RestApiId": { "Ref": "RestApi" },
      "ResourceId": { "Ref": "Resource" },
      "HttpMethod": "PUT",
      "Integration": {
        "Type": "AWS",
        "IntegrationHttpMethod": "POST",
        "Uri": {
          "Fn::Join": [
            "",
            [
              "arn:aws:apigateway:",
              { "Ref": "AWS::Region" },
              ":lambda:path/2015-03-31/functions/",
              { "Fn::GetAtt": ["Lambda", "Arn"] },
              "/invocations"
            ]
          ]
        },
        "IntegrationResponses": [
          {
            "StatusCode": 204
          }
        ],
        "RequestTemplates": {
          "application/json": "{\"action\": \"put\", \"body\": $input.json('$')}"
        }
      },
      "RequestModels": {
        "application/json": { "Ref": "Model" }
      },
      "RequestParameters": {
        "method.request.header.Authorization": true
      },
      "MethodResponses": [
        {
          "ResponseModels": {
            "application/json": "Empty"
          },
          "StatusCode": 204
        }
      ]
    }
  }
}
